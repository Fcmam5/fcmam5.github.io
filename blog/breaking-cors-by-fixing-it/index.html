<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.1.1">
<title data-rh="true">Breaking CORS by &quot;trying to fix it&quot; | Abdeldjalil Fortas&#x27; notepad</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://fcmam5.me/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://fcmam5.me/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://fcmam5.me/blog/breaking-cors-by-fixing-it"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Breaking CORS by &quot;trying to fix it&quot; | Abdeldjalil Fortas&#x27; notepad"><meta data-rh="true" name="description" content="How we can break CORS by trying to &quot;fix it&quot; blindly"><meta data-rh="true" property="og:description" content="How we can break CORS by trying to &quot;fix it&quot; blindly"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2024-04-21T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/fcmam5"><meta data-rh="true" property="article:tag" content="backend,frontend,security"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://fcmam5.me/blog/breaking-cors-by-fixing-it"><link data-rh="true" rel="alternate" href="https://fcmam5.me/blog/breaking-cors-by-fixing-it" hreflang="en"><link data-rh="true" rel="alternate" href="https://fcmam5.me/blog/breaking-cors-by-fixing-it" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Abdeldjalil Fortas&#39; notepad RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Abdeldjalil Fortas&#39; notepad Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6WM7E899MF"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-6WM7E899MF",{anonymize_ip:!0})</script><link rel="stylesheet" href="/assets/css/styles.4df8e218.css">
<script src="/assets/js/runtime~main.b409d491.js" defer="defer"></script>
<script src="/assets/js/main.ad8673e8.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_xEQj" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/apple-touch-icon.png" alt="My Site Logo" class="themedComponent_P4TV themedComponent--light_GMZT"><img src="/img/apple-touch-icon.png" alt="My Site Logo" class="themedComponent_P4TV themedComponent--dark_f3b1"></div><b class="navbar__title text--truncate">Fcmam5</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/fcmam5" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_oQ0q"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_CLW6 colorModeToggle_MQXf"><button class="clean-btn toggleButton_DSuF toggleButtonDisabled_Ne1j" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_V6VV"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_Vkb0"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_tLhS"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_fucJ"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_duTa thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_Ezkf margin-bottom--md">Recent posts</div><ul class="sidebarItemList_iDo5 clean-list"><li class="sidebarItem_d8rs"><a aria-current="page" class="sidebarItemLink_RTiY sidebarItemLinkActive_xuCe" href="/blog/breaking-cors-by-fixing-it">Breaking CORS by &quot;trying to fix it&quot;</a></li><li class="sidebarItem_d8rs"><a class="sidebarItemLink_RTiY" href="/blog/why-you-should-kick-idle-users-out-of-your-website">Why you should kick idle users out of your website</a></li><li class="sidebarItem_d8rs"><a class="sidebarItemLink_RTiY" href="/blog/avoiding-nestjs-performance-bottlenecks">Avoiding NestJS performance bottlenecks</a></li><li class="sidebarItem_d8rs"><a class="sidebarItemLink_RTiY" href="/blog/ctf-as-a-developer-pt-1-template-engines-ssti">CTF as a developer (Pt. 1): Template engines &amp; SSTI</a></li><li class="sidebarItem_d8rs"><a class="sidebarItemLink_RTiY" href="/blog/trying-to-become-a-better-developer-by-learning-more-about-aviation">Trying to become a better developer by learning more about aviation</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="https://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="https://schema.org/BlogPosting"><meta itemprop="description" content="How we can break CORS by trying to &quot;fix it&quot; blindly"><header><h1 class="title_sJZC" itemprop="headline">Breaking CORS by &quot;trying to fix it&quot;</h1><div class="container_Dsi3 margin-vert--md"><time datetime="2024-04-21T00:00:00.000Z" itemprop="datePublished">April 21, 2024</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_hcHb"><div class="avatar margin-bottom--sm"><a href="https://github.com/fcmam5" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/fcmam5.png" alt="Abdeldjalil Fortas" itemprop="image"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/fcmam5" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Abdeldjalil Fortas</span></a></div><small class="avatar__subtitle" itemprop="description">A part-time Karantika lover</small></div></div></div></div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>Okay, that&#x27;s another article about CORS on the internet.</p>
<p>CORS errors are definitely one of the most frustrating errors we face when working on web applications. I don&#x27;t know what HTTP wizard or how expert you are, but I am sure that you definitely react like Michael Scott here:</p>
<p><img decoding="async" loading="lazy" alt="Michael Scott screaming at CORS issue" src="/assets/images/the-office-m-scott-screaming-at-cors-df2e5ff48704c1ea0cc3935fa8c1f5d9.png" width="1600" height="840" class="img_H9vG"></p>
<small><p><em>Meme shamelessly stolen from <a href="https://fatimamo.com/become-a-cors-wizard" target="_blank" rel="noopener noreferrer">this blog</a></em></p></small>
<p>We may break &quot;CORS&quot; or at least break the security barriers it adds by trying to fix it (without understanding it correctly).</p>
<p>According to <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank" rel="noopener noreferrer">MDN</a>:</p>
<blockquote>
<p><strong>Cross-Origin Resource Sharing (CORS)</strong> is an <a href="https://developer.mozilla.org/en-US/docs/Glossary/HTTP" target="_blank" rel="noopener noreferrer">HTTP</a>-header based mechanism that allows a server to indicate any <a href="https://developer.mozilla.org/en-US/docs/Glossary/Origin" target="_blank" rel="noopener noreferrer">origins</a> (domain, scheme, or port) other than its own from which a browser should permit loading resources. CORS also relies on a mechanism by which browsers make a &quot;preflight&quot; request to the server hosting the cross-origin resource, in order to check that the server will permit the actual request. In that preflight, the browser sends headers that indicate the HTTP method and headers that will be used in the actual request.</p>
</blockquote>
<p>Now, before you scroll down this article looking for examples where I show you how to carelessly allow all origins to make your new shiny React or Vue application &quot;work&quot;, let&#x27;s ramble for a little bit, and try to make the web a better place.</p>
<h2 class="anchor anchorWithStickyNavbar_PV8p" id="the-problem-with-cors">The problem with CORS<a href="#the-problem-with-cors" class="hash-link" aria-label="Direct link to The problem with CORS" title="Direct link to The problem with CORS">​</a></h2>
<p>The problem with CORS is <strong>YOU</strong>, <strong>ME</strong>, and the over-simplified tutorials on the internet.</p>
<p>CORS, is a security mechanism to protect applications from being called from untrusted origins.</p>
<p>It is a way where you authorize certain clients to call your application from whitelisted origins. For example, if you have a backend API being served from <code>https://api.kavi.wiw</code>, the outcome will be the following:</p>
<table><thead><tr><th>Client</th><th>Server (Target)</th><th>Outcome</th></tr></thead><tbody><tr><td><code>https://api.kavi.wiw/v1</code></td><td><code>https://api.kavi.wiw</code></td><td><code>Same origin</code></td></tr><tr><td><code>http://api.kavi.wiw/</code></td><td><code>https://api.kavi.wiw</code></td><td><code>Different protocol</code></td></tr><tr><td><code>https://api.kavi.wiw:8080/</code></td><td><code>https://api.kavi.wiw</code></td><td><code>Different port</code></td></tr><tr><td><code>https://www.kavi.wiw/</code></td><td><code>https://api.kavi.wiw</code></td><td><code>Different host</code></td></tr></tbody></table>
<p>Two objects have the same origin only when the scheme (protocol), hostname (domain), and port all match.</p>
<p>If my shiny Angular or React front-end application is served from <code>https://www.kavi.wiw/</code> and tries to consume my Node.js APIs on <code>http://api.kavi.wiw/</code>, I mostly likely will get the following error:</p>
<div class="codeBlockContainer_KNDO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Gjbw"><pre tabindex="0" class="prism-code language-text codeBlock_CjlJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_D9LQ"><span class="token-line" style="color:#393A34"><span class="token plain">XMLHttpRequest cannot load http://api.kavi.wiw/.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">No &#x27;Access-Control-Allow-Origin&#x27; header is present on the requested resource. </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Origin &#x27;null&#x27; is therefore not allowed access.</span><br></span></code></pre><div class="buttonGroup_e9bE"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JVcx" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ojVv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Xe0s"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This error is thrown by my browser, as it doesn&#x27;t let my front-end to call my backend. That&#x27;s to protect my backend from possible malicious actions I can perform by tweaking the front-end code and hosting it somewhere else, or by tweaking it and making it call unauthorized hosts (e.g. <code>http://admin.kavi.wiw/</code>).</p>
<p>However, we understood from the error that <code>Access-Control-Allow-Origin</code> is missing. So we can add it to our server responses, but what values should it have?</p>
<p>Tutorials online mostly use wildcards (<code>*</code>), or advice to use packages blindly, I mean even the &quot;GREAT&quot; ChatGPT told me this:</p>
<p><img decoding="async" loading="lazy" alt="ChatGPT advising to use cors package" src="/assets/images/chat-gpt-fix-cors-a7b12d1807b8f24d3a5657509081e9c0.png" width="1274" height="1434" class="img_H9vG"></p>
<p>It advised me to use <code>cors</code> package for this example, but if I ask it to not libraries I got the following answer:</p>
<p><img decoding="async" loading="lazy" alt="ChatGPT advising to allow all" src="/assets/images/chat-gpt-fix-cors-no-npm-f07495b4226ac2a65e116d245f1264b9.png" width="1316" height="1328" class="img_H9vG"></p>
<p>Both approaches <strong>might be</strong> dangerous, or at least present some bad practices. If you spotted them, feel free to stop reading this article (unless you want to verify your/my information and probably suggest more clarification).</p>
<h3 class="anchor anchorWithStickyNavbar_PV8p" id="using-packages-with-default-params">Using packages with default params<a href="#using-packages-with-default-params" class="hash-link" aria-label="Direct link to Using packages with default params" title="Direct link to Using packages with default params">​</a></h3>
<p>Unless you are a public resource that can be accessed from <strong>ANY origin</strong>, and can be called using <strong>ANY HTTP verb</strong>, using default configuration from packages like <a href="https://www.npmjs.com/package/cors" target="_blank" rel="noopener noreferrer">Node.js&#x27;s <code>cors</code></a> may present some risks, or at least break the intentions behind having CORS protection.</p>
<p>This implementation:</p>
<div class="language-javascript codeBlockContainer_KNDO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Gjbw"><pre tabindex="0" class="prism-code language-javascript codeBlock_CjlJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_D9LQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> express </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;express&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> cors </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;cors&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">cors</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_e9bE"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JVcx" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ojVv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Xe0s"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Is equivalent to having (see <a href="https://www.npmjs.com/package/cors#configuration-options" target="_blank" rel="noopener noreferrer"><code>cors</code> package configuration options</a>):</p>
<div class="language-javascript codeBlockContainer_KNDO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Gjbw"><pre tabindex="0" class="prism-code language-javascript codeBlock_CjlJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_D9LQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> express </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;express&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> cors </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;cors&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">cors</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;origin&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;*&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;methods&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;GET&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;preflightContinue&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">false</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;optionsSuccessStatus&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">204</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_e9bE"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JVcx" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ojVv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Xe0s"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>These default parameters set a wild card for <code>Access-Control-Allow-Origin</code> header, and authorize all (<code>GET,HEAD,PUT,PATCH,POST,DELETE</code>) headers in <code>Access-Control-Allow-Methods</code>.</p>
<p>You probably just need to authorize certain requests from certain origins. For example, if your public website only serves resources to a static website that only consumes content with <code>GET</code>, you may only need:</p>
<div class="language-javascript codeBlockContainer_KNDO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Gjbw"><pre tabindex="0" class="prism-code language-javascript codeBlock_CjlJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_D9LQ"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> express </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;express&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> cors </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;cors&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> app </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">express</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">cors</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;origin&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;https://www.kavi.wiw&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string-property property" style="color:#36acaa">&quot;methods&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;GET&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_e9bE"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JVcx" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ojVv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Xe0s"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_PV8p" id="adding-cors-headers-when-not-using-packages">Adding CORS headers (when not using packages)<a href="#adding-cors-headers-when-not-using-packages" class="hash-link" aria-label="Direct link to Adding CORS headers (when not using packages)" title="Direct link to Adding CORS headers (when not using packages)">​</a></h3>
<p>In the second example, ChatGPT proposed allowing all origins similarly as we may find in many answers on different forums online.</p>
<div class="language-javascript codeBlockContainer_KNDO theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_Gjbw"><pre tabindex="0" class="prism-code language-javascript codeBlock_CjlJ thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_D9LQ"><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">req</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> res</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> next</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Access-Control-Allow-Origin&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;*&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Access-Control-Allow-Methods&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;GET, POST, PUT, PATCH, DELETE&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    res</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">setHeader</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;Access-Control-Allow-Headers&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;Content-Type, Authorization&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">next</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><br></span></code></pre><div class="buttonGroup_e9bE"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_JVcx" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_ojVv"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_Xe0s"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The following snippet may present the same challenges with unwanted results as we may get when using packages like <a href="https://www.npmjs.com/package/cors#configuration-options" target="_blank" rel="noopener noreferrer"><code>cors</code></a>.</p>
<h3 class="anchor anchorWithStickyNavbar_PV8p" id="using-proxies">Using proxies<a href="#using-proxies" class="hash-link" aria-label="Direct link to Using proxies" title="Direct link to Using proxies">​</a></h3>
<p>Many tutorials online suggest using proxies (either building our own proxies, or using solutions like <a href="https://github.com/Rob--W/cors-anywhere/" target="_blank" rel="noopener noreferrer">cors-anywhere</a>), this solution when used blindly or without knowing the &quot;Why&quot;s and the &quot;How&quot;s of HTTP/CORS can present security risks, and it may create backdoors by intentionally exposing, or at least facilitating the reach to protected resources.</p>
<h2 class="anchor anchorWithStickyNavbar_PV8p" id="possible-solutions">Possible solutions<a href="#possible-solutions" class="hash-link" aria-label="Direct link to Possible solutions" title="Direct link to Possible solutions">​</a></h2>
<p>There are no generic solutions. But there are best practices, and these are very project-specific. Don&#x27;t take advice from random people online. Learn the basics and make your own judgment, or learn to ask the right questions.</p>
<p>Learn more about CORS on:</p>
<ul>
<li>Cross-Origin Resource Sharing (CORS): <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS" target="_blank" rel="noopener noreferrer">https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS</a></li>
<li>CORS Tutorial: A Guide to Cross-Origin Resource Sharing: <a href="https://auth0.com/blog/cors-tutorial-a-guide-to-cross-origin-resource-sharing/" target="_blank" rel="noopener noreferrer">https://auth0.com/blog/cors-tutorial-a-guide-to-cross-origin-resource-sharing/</a></li>
<li>Become a CORS Wizard 🧙‍♀️: <a href="https://fatimamo.com/become-a-cors-wizard" target="_blank" rel="noopener noreferrer">https://fatimamo.com/become-a-cors-wizard</a></li>
<li>I want to add CORS support to my server: <a href="https://enable-cors.org/server.html" target="_blank" rel="noopener noreferrer">https://enable-cors.org/server.html</a></li>
<li>Front-end Developer Handbook 2019: <a href="https://frontendmasters.com/guides/front-end-handbook/2019/?#4.4" target="_blank" rel="noopener noreferrer">https://frontendmasters.com/guides/front-end-handbook/2019/?#4.4</a></li>
</ul></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_ImY_"><div class="col"><b>Tags:</b><ul class="tags_CmaD padding--none margin-left--sm"><li class="tag_V4oS"><a class="tag_VJzX tagRegular_lCRA" href="/blog/tags/backend">backend</a></li><li class="tag_V4oS"><a class="tag_VJzX tagRegular_lCRA" href="/blog/tags/frontend">frontend</a></li><li class="tag_V4oS"><a class="tag_VJzX tagRegular_lCRA" href="/blog/tags/security">security</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/Fcmam5/fcmam5.github.io/tree/master/portfolio/blog/blog/2024-04-21-fixing-cors/index.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_fdNh" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog/why-you-should-kick-idle-users-out-of-your-website"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Why you should kick idle users out of your website</div></a></nav></main><div class="col col--2"><div class="tableOfContents_WYoy thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-problem-with-cors" class="table-of-contents__link toc-highlight">The problem with CORS</a><ul><li><a href="#using-packages-with-default-params" class="table-of-contents__link toc-highlight">Using packages with default params</a></li><li><a href="#adding-cors-headers-when-not-using-packages" class="table-of-contents__link toc-highlight">Adding CORS headers (when not using packages)</a></li><li><a href="#using-proxies" class="table-of-contents__link toc-highlight">Using proxies</a></li></ul></li><li><a href="#possible-solutions" class="table-of-contents__link toc-highlight">Possible solutions</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">About me</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/contributions">Contributions</a></li><li class="footer__item"><a class="footer__link-item" href="/libraries">Libraries</a></li><li class="footer__item"><a href="https://www.credly.com/users/fcmam5" target="_blank" rel="noopener noreferrer" class="footer__link-item">Creedly<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_oQ0q"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Let&#x27;s connect</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/Fcmam5" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_oQ0q"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stackoverflow.com/users/5078746/fcmam5" target="_blank" rel="noopener noreferrer" class="footer__link-item">StackOverflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_oQ0q"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://linkedin.com/in/fcmam5" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_oQ0q"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/Fcmam5" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_oQ0q"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://medium.com/@Fcmam5" target="_blank" rel="noopener noreferrer" class="footer__link-item">Medium<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_oQ0q"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2024 Abdeldjalil Fortas. Built with Docusaurus (while drinking green tea this time).</div></div></div></footer></div>
</body>
</html>